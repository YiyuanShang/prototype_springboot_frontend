<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
</head>
<body>
<form>
    <label for="userId">User Id</label>
    <input type="number" id="userId" value=""><br>

    <label for="name">Name</label>
    <input type="text" id="name" value=""><br>

    <label for="age">Age</label>
    <input type="number" id="age" value=""><br>

    <label for="membership">Membership</label>
    <input type="radio" name="membership" value="true">yes
    <input type="radio" name="membership" value="false">no <br>

    <input type="submit" value="Update User" onclick="return updateUser()">
</form>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>
function loadUserInfo(){
    var userId = window.sessionStorage.getItem("userId");
    console.log("get userId:" + userId);

    //load user information
    $.ajax({
        method: "GET",
        url: "http://localhost:8080/users/" + userId,
        statusCode: {
            404: function() {
                console.log( "page not found" );
            },
            500: function () {
                console.log("internal error")
            }
        }
    }).done(function (data){
        console.log("user:" + Object.entries(data));
        $("#userId").val(data.userId);
        $("#name").val(data.name);
        $("#age").val(data.age);
        $("input[name='membership'][value='" + data.membership + "']").attr("checked", true);

    }).fail(function(jqXHR, textStatus, errorThrown) {
        alert("textStatus:" + textStatus + " errorThrown:" + errorThrown);
    }).always(function(){
        console.log("complete")
    });

}

function updateUser(){
    console.log("entering updateUser()");
    var userId = $("#userId").val();
    var name = $("#name").val();
    var age = $("#age").val();
    var membership = $("input[name='membership']:checked").val();

    var obj = {
        userId : userId,
        name : name,
        age : age,
        membership : membership
    };

    var param = JSON.stringify(obj);
    console.log("user json:" + param);
    alert("user json:" + param);

    $.ajax({
        method:"PUT",
        url: "http://localhost:8080/users",
        data: param,
        // dataType: 'jsonp',
        // crossOrigin: true,
        // headers: {'Access-Control-Allow-Origin': 'http://localhost:8080'},
        async: false,
        statusCode: {
            200: function (){
                alert("Update succeeded!");
                window.location.href = "http://localhost:63342/prototype_springboot_frontend/public/user/user_list.html";
            },
            404: function() {
                console.log( "page not found" );
            },
            500: function () {
                console.log("internal error")
            }
        }
    }).done(function(data) {
        console.log("returned data:" + data);
    }).fail(function(jqXHR, textStatus, errorThrown) {
        alert("textStatus:" + textStatus + " errorThrown:" + errorThrown);
    }).always(function(){
        console.log("update complete");
    });
}

loadUserInfo();
</script>
</body>
</html>